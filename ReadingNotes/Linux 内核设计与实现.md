# 第一章 Linux内核简介
## 1.1 Unix的历史
Unix 已经存在 50 年 , 计算机科学家任然认为它是最强大最优秀的操作系统 . 
许多组织对 Unix 进行重开发 , 影响最大的一个是加州大学伯克利分校的 BSD , 其中的 csh , vi 等工具现在还在使用 . 伯克利在 3BSD 开始自主研发 , 引入虚拟内存 . 
Unix 强大的根本原因 : 

- 设计简洁 , 几百个系统调用且有明确的设计目的
- 万物皆文件 , 几乎所有的东西都表示为文件 , 可以通过同一套系统调用控制
- 内核和相关的系统工具都是使用 C 编写的 , 可移植性非常高
- 进程创建快 , 有一个独特的 `fork()` 系统调用
- 有一套简单稳定的通信元语 , 使程序集中目标在**一次执行保质保量地完成一个任务**
## 1.2 追寻 Linus 的足迹 : Linux 简介
1991 年 Linus Torvalds 为新推出的计算机开发了一款全新的操作系统 , 就是 Linux . 
当时的 DOS 除了玩波斯王子一无用处 , 而 Linux 喜欢的 Minix 系统 , 一款教学用的廉价 Unix , 却由于许可证原因不能修改 . 那么 Linus 开始自己写操作系统 . 写完原型后在网上发布后得到很多人的认可 , 并且对其代码进行完善和修改 . 事实上归功于其许可证 , GPL2 , 所有人都可以拿到代码并修改 , 但是需要保证修改后的代码保持相同的许可证 . 
Linux 并没有直接使用 Unix 的代码 , 很多时候实现方式大相径庭 , 但是保持应用程序接口一致的原则 . Linux 我们一般指的是内核 . 
## 1.3 操作系统和内核简介
操作系统包括内核 , 内核处于核心和管理者地位 , 用户界面属于外壳 . 一般内核由一个负责响应处理中断的程序 , 一个负责管理多个进程分享处理器时间的调度程序 , 负责管理进程地址空间的内存管理程序和网络 , 进程间通信等系统服务程序组成 . 
现代操作系统具有保护机制 , 内核独立其他应用程序 , 处于内核态 , 具有保护的内存空间和访问所有硬件设备 . 一般的应用程序只运行在用户态 . 系统根据运行的不同 , 运行内核 , 以内核态进入内核空间运行 ; 应用程序运行时以用户态进入用户空间运行 . 
应用程序通过系统调用与内核通信 , 一般通过库函数进入系统调用界面 , 让内核代其执行任务 . 例如调用 `printf` 函数的时候 , 会执行 `write()` , 而 `strcpy` 根本没有调用系统调用 . 应用程序如果执行一条系统调用 , 我们称为**内核正在代其运行** , 应用程序通过系统调用在内核空间运行 , 内核则运行在**进程上下文**中 . 应用程序通过系统调用陷入内核空间 , 这是应用程序完成其工作的基本行为方式 . 
内核还要负责管理硬件设备 , 一般通过中断机制 , 硬件设备在想要与系统通信时 , 会发出一个异步中断信号 , 打断处理器运行和内核 , 通过携带的中断号查找对应的中断处理程序 , 调用其处理中断 . 中断可以被屏蔽 , 为了数据的同步 , 而且许多操作系统 , 包括 Linux , 中断服务系统都运行于中断上下文 , 与所有的进程无关 , 为了能第一时间响应中断 . 
![image.png](img/Linux%20%E5%86%85%E6%A0%B8%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/1667996055126-f0f3c17a-48c9-463a-ae9b-1c2a8a67f929.png )
上下文代表活动范围 , 任意时刻处理器总是处于以下三者之一 : 

- 运行于用户空间 , 执行用户进程
- 运行在内核空间 , 处于进程上下文 , 代某个特定进程执行
- 运行在内核空间 , 处于进程上下文 , 与任何进程无关 , 处理某个特定中断

就算是处理器没有任何工作 , 内核就运行一个空进程 , 处于进程上下文 , 但运行在内核空间 . 
## Linux 内核和传统 Unix 内核的比较

