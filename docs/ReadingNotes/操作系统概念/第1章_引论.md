# 第 1 章：导论

[[toc]]
## 1.1 操作系统的功能

计算机系统粗分为硬件、软件、应用程序和用户。

从用户视角来说，操作系统封装了复杂的硬件，使用者可以简单的通过用户接口使用计算机。不同用户也可以通过终端访问同一套资源，现在的智能手机一般是单用户，那么更在乎性能。

从系统视角来说，操作系统是与硬件相连的程序，主要作用就是，资源分配；其次就是管理程序的执行。

接下来提到了一个关于操作系统的定义，这里的说法非常好。

::: tip 操作系统的定义

一般来说，我们没有一个关于操作系统的完全准确的定义。操作系统的存在是因为它们提供了合理方式来解决创建可用计算系统的问题，计算机系统的根本目的是，执行用户程序并且更容易解决用户问题。为实现这一目的，构造了计算机硬件。由于硬件本身并不十分容易使用，因此开发了应用程序。这些应用程序需要一些共同操作，如控制 IO 设备。这些控制和分配 I/O 设备资源的共同功能则被组成一个软件模块：操作系统。

:::

## 1.2 计算机系统的组成

### 1.2.1 计算机系统的运行

现代系统包括处理器和多个设备控制器组成，通过总线连接竞争访问内存。不同控制器和 CPU 之间可以并行运行，通过总线访问内存需要通过内存控制器协调。

![image-20230716224534990](./img/image-20230716224534990-9518747.png)

计算机启动时，需要运行初始化程序。这个初始化程序 (Boot) 位于计算机的固件，可能是 ROM 或者 EPPROM 中。这个程序会先完成初始化，包括寄存器，设备管理器和内存内容。其次 Boot 需要知晓操作系统内核的相关信息，主要是需要把操作系统加载到内存中，完成启动。

::: tip Tell me, ChatGPT: ROM 和 EPPROM

ROM 和 EPROM 是两种常见的非易失性存储器类型，用于存储计算机和其他电子设备中的程序和数据。它们在存储原理和可编程性方面有所不同。

1. ROM (只读存储器)：
ROM 是一种只能读取而不能编程或擦除的存储器。它在制造时被编程，一旦编程完成，其中的数据就无法更改。ROM 存储器包含一个固定的指令集和数据，这些数据被永久存储在芯片中。ROM 的内容通常由计算机制造商或芯片设计者预先设置，用于存储引导程序、固件、操作系统和其他重要数据。

2. EPROM (可擦除可编程只读存储器)：
EPROM 是一种可擦除可编程的存储器，它可以被多次擦除和重新编程。EPROM 存储器在制造时是空白的，可以被程序员编程，一旦编程完成，数据将一直保存，直到被擦除。EPROM 芯片具有一个透明的窗口，通过这个窗口，可以使用特殊的设备将紫外线照射到芯片上以擦除其中的数据。擦除后，EPROM 可以重新编程，并且可以多次重复这个擦除-编程-读取的过程。

EPROM 的可擦除性使得它在开发和测试阶段非常有用，因为可以多次修改和更新其中的数据。然而，EPROM 需要特殊的擦除设备，并且擦除操作是相对较慢的。因此，为了提高可擦除存储器的易用性，后来出现了闪存存储器 (Flash Memory)，它是一种在不需要特殊设备的情况下可以擦除和编程的存储器类型，常用于计算机、手机和其他电子设备中。

总结：ROM 是只读存储器，数据在制造时被编程，无法更改。EPROM 是可擦除可编程的存储器，可以多次擦除和重新编程。两者都是非易失性存储器，可以长时间保存数据，但 EPROM 在可编程性和擦除方面更灵活一些。

:::

内核加载到内存后，开始为系统和其他程序提供服务。系统启动过程也会启动其他系统进程或后台服务，在 Unix 中通过的是 init 进程完成的初始化，之后通过软硬件的中断实现事件的通知，硬件随时可以通过总线把中断信号传送到 CPU，软件可以通过特定的系统调用触发中断。

CPU 在触发中断时会做出反映，可以通过优先级决定是否相应，随后保存现场，停止运行，根据中断向量表去执行中断处理程序，随后再继续执行之前的工作。

![image-20230716233523069](./img/image-20230716233523069-9521726.png)

中断是计算机体系结构的重要部分，不同的计算机有自己的中断机制，但是有些功能是类似的。中断处理可以通过一个程序实现，但是这个程序必须响应快。由于预定义的中断并不多，所以可以通过中断程序的指针表或者中断向量实现间接调用，在低地址内存防止指针表，中断触发通过设备号等快速读取对应的程序指针执行。

中断结构体系也需要保存中断地址，以前使用的是固定位置或可用设备号索引的固定位置，现代计算机体系一般是堆栈。其次如果中断程序需要修改 CPU 状态，要保存现场并在执行完毕前返回保证被中断程序的正常的访问。

::: info 存储定义与符号

计算机的存储基本单位是位 (bit)，也就是比特，表示 0 或者 1。通过不同的编码可以表示多种的信息。但是一般计算机中的最小单位是字节 (byte)，也是大多数计算机操作的最小单位，大多数没有直接移动一位的指令，但是有移动一位字节的。下一个是字 (word)，一般根据计算机的位数决定字长，许多操作都是针对字的。

关于单位，计算机一般是使用的是字节计数，也就是 KB、MB、GB、TB 和 PB。1024 一进位。但是计算机制造商一般使用圆整，1000 一进位，例如硬盘厂商，其实这部分是用在一些管理文件上。网络相关的会使用 Kb，Mb，Gb，区别是 B 和 b，因为网络一次移动一位。注意大小写，1B = 8b，也就是 Byte 和 bit 的转换

:::

### 1.2.2 存储结构

